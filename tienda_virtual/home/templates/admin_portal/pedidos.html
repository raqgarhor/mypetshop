{% extends "admin_portal/base.html" %}

{% block title %}Pedidos - Panel de Administración{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Gestión de Pedidos</h1>
</div>

<div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <form method="get" style="display: flex; gap: 15px; align-items: center;">
        <label>Filtrar por estado:</label>
        <select name="estado" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="">Todos</option>
            {% for estado_val, estado_label in estados %}
            <option value="{{ estado_val }}" {% if estado_filtro == estado_val %}selected{% endif %}>
                {{ estado_label }}
            </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-admin btn-primary">Filtrar</button>
        {% if estado_filtro %}
        <a href="{% url 'admin_panel:pedidos' %}" class="btn-admin" style="background: #95a5a6; color: white;">Limpiar</a>
        {% endif %}
    </form>
</div>

<div class="admin-table">
    <table>
        <thead>
            <tr>
                <th>Número Pedido</th>
                <th>Cliente</th>
                <th>Email</th>
                <th>Estado</th>
                <th>Total</th>
                <th>Fecha</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr>
                <td>{{ pedido.numero_pedido }}</td>
                <td>{{ pedido.cliente.nombre|default:"Sin cliente" }} {{ pedido.cliente.apellidos|default:"" }}</td>
                <td>{{ pedido.cliente.email|default:"-" }}</td>
                <td>
                    <span class="badge badge-{{ pedido.estado }}">
                        {{ pedido.get_estado_display }}
                    </span>
                </td>
                <td>{{ pedido.total }} €</td>
                <td>{{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</td>
                <td>
                    <a href="{% url 'admin_panel:pedido_detalle' pedido.id_pedido %}" class="btn-admin btn-primary">Ver Detalle</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 20px;">No hay pedidos</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Paginación -->
{% if pedidos.has_other_pages %}
<div class="pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
    {% if pedidos.has_previous %}
        <a href="?page=1{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}" 
           class="btn-admin btn-primary" style="padding: 8px 12px;">Primera</a>
        <a href="?page={{ pedidos.previous_page_number }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}" 
           class="btn-admin btn-primary" style="padding: 8px 12px;">« Anterior</a>
    {% endif %}
    
    <span style="padding: 8px 12px;">
        Página {{ pedidos.number }} de {{ pedidos.paginator.num_pages }}
    </span>
    
    {% if pedidos.has_next %}
        <a href="?page={{ pedidos.next_page_number }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}" 
           class="btn-admin btn-primary" style="padding: 8px 12px;">Siguiente »</a>
        <a href="?page={{ pedidos.paginator.num_pages }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}" 
           class="btn-admin btn-primary" style="padding: 8px 12px;">Última</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}

